<section class="faq-wrapper" id="faq-root">

    <!-- HERO -->
    <div class="faq-hero" aria-labelledby="faq-heading">
        <h1 id="faq-heading" class="faq-title">Frequently Asked Questions</h1>
        <p class="faq-subtitle">
            Minimal, accessible, mobile-first FAQ for the Mbapp√© / Haaland / Vin√≠cius statistics website.
        </p>

        <div class="faq-search-wrap" role="search">
            <div class="faq-search">
                <span class="faq-search-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </span>

                <input id="faq-search" type="search" placeholder="Search questions..." aria-label="Search FAQ" />
            </div>
        </div>

        {{#if admin}}
        <button id="faq-add-btn" class="faq-add-btn">Add Question</button>
        {{/if}}

        <div class="faq-modal" id="faq-modal">
            <div class="faq-modal-content">
                <h2>Add New FAQ</h2>

                <label>Question</label>
                <input type="text" id="faq-question" class="faq-input" placeholder="Enter question">

                <label>Category</label>
                <select id="faq-type" class="faq-input">
                    <option value="Statistics & Records">Statistics & Records</option>
                    <option value="Technical">Technical</option>
                    <option value="About Us">About Us</option>
                    <option value="Support & Contact">Support & Contact</option>
                </select>

                <label>Answer</label>
                <textarea id="faq-ans" class="faq-input" placeholder="Enter answer"></textarea>

                <button id="faq-submit" class="faq-submit-btn">Submit</button>
                <button id="faq-close" class="faq-close-btn">Close</button>
            </div>
        </div>



        <!-- MAIN LAYOUT -->
        <div class="faq-main">

            <!-- SIDEBAR -->
            <aside class="faq-sidebar">
                <div class="faq-sidebar-sticky">
                    <nav aria-label="Categories">
                        <ul class="faq-categories" id="faq-categories">

                            <!-- Statistics & Records -->
                            <li>
                                <button class="faq-cat-btn" data-target="general" aria-current="true">
                                    <span class="faq-cat-icon">
                                        <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                            <line x1="9" y1="17" x2="9" y2="7"></line>
                                            <line x1="15" y1="17" x2="15" y2="3"></line>
                                            <line x1="21" y1="17" x2="21" y2="11"></line>
                                            <line x1="3" y1="17" x2="3" y2="13"></line>
                                        </svg>
                                    </span>
                                    Statistics & Records
                                </button>
                            </li>

                            <!-- Technical -->
                            <li>
                                <button class="faq-cat-btn" data-target="technical">
                                    <span class="faq-cat-icon">
                                        <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                            <circle cx="12" cy="12" r="3"></circle>
                                            <path
                                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a1.65 1.65 0 0 1-2.33 2.33l-.06-.06A1.65 1.65 0 0 0 15 19.4a1.65 1.65 0 0 0-1.82.33h-.06a1.65 1.65 0 0 1-2.33-2.33v-.06A1.65 1.65 0 0 0 8.6 15a1.65 1.65 0 0 0-1.82-.33h-.06a1.65 1.65 0 0 1-2.33-2.33l.06-.06A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a1.65 1.65 0 0 1 2.33-2.33l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1.82-.33h.06a1.65 1.65 0 0 1 2.33 2.33v.06A1.65 1.65 0 0 0 15 8.6a1.65 1.65 0 0 0 1.82.33h.06a1.65 1.65 0 0 1 2.33 2.33l-.06.06A1.65 1.65 0 0 0 19.4 15z">
                                            </path>
                                        </svg>
                                    </span>
                                    Technical
                                </button>
                            </li>

                            <!-- About Us -->
                            <li>
                                <button class="faq-cat-btn" data-target="about">
                                    <span class="faq-cat-icon">
                                        <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="16" x2="12" y2="12"></line>
                                            <line x1="12" y1="8" x2="12" y2="8"></line>
                                        </svg>
                                    </span>
                                    About Us
                                </button>
                            </li>

                            <!-- Support & Contact -->
                            <li>
                                <button class="faq-cat-btn" data-target="support">
                                    <span class="faq-cat-icon">
                                        <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                            <path d="M18 10a6 6 0 0 0-12 0c0 2.93-1 4-1 4h4v5h6v-5h4s-1-1.07-1-4z">
                                            </path>
                                        </svg>
                                    </span>
                                    Support & Contact
                                </button>
                            </li>

                        </ul>
                    </nav>
                </div>
            </aside>

            <!-- CONTENT -->
            <div class="faq-content">

                <!-- SECTION: General -->
                <article class="faq-section" id="general">
                    <h2 class="faq-section-title">
                        <span class="faq-section-icon-box">
                            <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <line x1="9" y1="17" x2="9" y2="7"></line>
                                <line x1="15" y1="17" x2="15" y2="3"></line>
                                <line x1="21" y1="17" x2="21" y2="11"></line>
                                <line x1="3" y1="17" x2="3" y2="13"></line>
                            </svg>
                        </span>
                        Statistics & Records
                    </h2>


                    <p class="faq-section-desc">Common questions about the player stats.</p>

                    <div class="faq-items">

                        {{#each statistics}}

                        <div class="faq-item" aria-expanded="false" data-id="{{this.no}}">

                            <div class="faq-actions">
                                <button class="faq-edit-btn" data-id="{{this.no}}">
                                    ‚úèÔ∏è
                                </button>
                                <button class="faq-del-btn" data-id="{{this.no}}">
                                    üóë
                                </button>
                            </div>

                            <button class="faq-toggle" aria-controls="faq-{{this.no}}">
                                <div class="faq-q-text">{{this.question}}</div>

                                <span class="faq-chev">
                                    <svg viewBox="0 0 24 24">
                                        <polyline points="6 9 12 15 18 9" />
                                    </svg>
                                </span>
                            </button>

                            <div class="faq-panel" id="faq-{{this.no}}">
                                <p>{{this.ans}}</p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </article>

                <!-- SECTION: Technical -->
                <article class="faq-section" id="technical">
                    <h2 class="faq-section-title">
                        <span class="faq-section-icon-box">
                            <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <line x1="9" y1="17" x2="9" y2="7"></line>
                                <line x1="15" y1="17" x2="15" y2="3"></line>
                                <line x1="21" y1="17" x2="21" y2="11"></line>
                                <line x1="3" y1="17" x2="3" y2="13"></line>
                            </svg>
                        </span>
                        Technical
                    </h2>


                    <p class="faq-section-desc">Common questions about the player stats.</p>

                    <div class="faq-items">

                        {{#each technical}}
                        <div class="faq-item" aria-expanded="false" data-id="{{this.no}}">

                            <div class="faq-actions">
                                <button class="faq-edit-btn" data-id="{{this.no}}">
                                    ‚úèÔ∏è
                                </button>
                                <button class="faq-del-btn" data-id="{{this.no}}">
                                    üóë
                                </button>
                            </div>

                            <button class="faq-toggle" aria-controls="faq-{{this.no}}">
                                <div class="faq-q-text">{{this.question}}</div>

                                <span class="faq-chev">
                                    <svg viewBox="0 0 24 24">
                                        <polyline points="6 9 12 15 18 9" />
                                    </svg>
                                </span>
                            </button>

                            <div class="faq-panel" id="faq-{{this.no}}">
                                <p>{{this.ans}}</p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </article>

                <!-- SECTION: About Us -->
                <article class="faq-section" id="about">
                    <h2 class="faq-section-title">
                        <span class="faq-section-icon-box">
                            <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <line x1="9" y1="17" x2="9" y2="7"></line>
                                <line x1="15" y1="17" x2="15" y2="3"></line>
                                <line x1="21" y1="17" x2="21" y2="11"></line>
                                <line x1="3" y1="17" x2="3" y2="13"></line>
                            </svg>
                        </span>
                        About Us
                    </h2>


                    <p class="faq-section-desc">Common questions about the player stats.</p>

                    <div class="faq-items">

                        {{#each about}}
                        <div class="faq-item" aria-expanded="false" data-id="{{this.no}}">

                            <div class="faq-actions">
                                <button class="faq-edit-btn" data-id="{{this.no}}">
                                    ‚úèÔ∏è
                                </button>
                                <button class="faq-del-btn" data-id="{{this.no}}">
                                    üóë
                                </button>
                            </div>

                            <button class="faq-toggle" aria-controls="faq-{{this.no}}">
                                <div class="faq-q-text">{{this.question}}</div>

                                <span class="faq-chev">
                                    <svg viewBox="0 0 24 24">
                                        <polyline points="6 9 12 15 18 9" />
                                    </svg>
                                </span>
                            </button>

                            <div class="faq-panel" id="faq-{{this.no}}">
                                <p>{{this.ans}}</p>
                            </div>
                            {{/each}}
                        </div>
                </article>


                <!-- SECTION: Support & Contact -->
                <article class="faq-section" id="support">
                    <h2 class="faq-section-title">
                        <span class="faq-section-icon-box">
                            <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
                                <line x1="9" y1="17" x2="9" y2="7"></line>
                                <line x1="15" y1="17" x2="15" y2="3"></line>
                                <line x1="21" y1="17" x2="21" y2="11"></line>
                                <line x1="3" y1="17" x2="3" y2="13"></line>
                            </svg>
                        </span>
                        Support & Contact
                    </h2>


                    <p class="faq-section-desc">Common questions about the player stats.</p>

                    <div class="faq-items">

                        {{#each support}}
                        <div class="faq-item" aria-expanded="false" data-id="{{this.no}}">

                            <div class="faq-actions">
                                <button class="faq-edit-btn" data-id="{{this.no}}">
                                    ‚úèÔ∏è
                                </button>
                                <button class="faq-del-btn" data-id="{{this.no}}">
                                    üóë
                                </button>
                            </div>

                            <button class="faq-toggle" aria-controls="faq-{{this.no}}">
                                <div class="faq-q-text">{{this.question}}</div>

                                <span class="faq-chev">
                                    <svg viewBox="0 0 24 24">
                                        <polyline points="6 9 12 15 18 9" />
                                    </svg>
                                </span>
                            </button>

                            <div class="faq-panel" id="faq-{{this.no}}">
                                <p>{{this.ans}}</p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </article>


                <!-- Other sections (Data, Voting, Reporting, Technical) identical structure -->
                <!-- ... YOU KEEP THE SAME STRUCTURE ... -->

            </div>

        </div>


        <!-- CTA -->
        <div class="faq-container">
            <div class="faq-support-card">
                <div class="faq-gold-line"></div>

                <div class="faq-icon">
                    <!-- Replace this SVG if you want a better one -->
                    <svg width="48" height="48" fill="#FFD700" viewBox="0 0 24 24">
                        <path
                            d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.45 8.45 0 0 1 8 8v.5z" />
                    </svg>
                </div>

                <h2 class="faq-title2">Still Have Questions?</h2>

                <p class="faq-subtitle2">
                    Can't find what you're looking for? Our support team is ready to help you with any questions
                    or concerns.
                </p>

                <a href="/contact" class="faq-contact-button">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path
                            d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.45 8.45 0 0 1 8 8v.5z" />
                    </svg>
                    Contact Support
                </a>
            </div>
        </div>


        {{>sts-update}}
</section>


<script>

    const addBtn = document.getElementById('faq-add-btn');
    const modal = document.getElementById('faq-modal');
    const closeBtn = document.getElementById('faq-close');
    const submitBtn = document.getElementById('faq-submit');

    // Open modal
    addBtn.addEventListener('click', () => {
        modal.style.display = 'flex';
    });

    // Close modal
    closeBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    // Submit FAQ
    submitBtn.addEventListener('click', async () => {
        const question = document.getElementById('faq-question').value;
        const type = document.getElementById('faq-type').value;
        const ans = document.getElementById('faq-ans').value;

        if (!question || !type || !ans) {
            alert("All fields required.");
            return;
        }

        const res = await fetch('/admin/faq/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question, type, ans })
        });

        if (res.ok) {
            alert("FAQ Added Successfully!");
            window.location.reload();
        } else {
            alert("Failed to add FAQ.");
        }
    });


    (function () {
        const $$ = (s) => Array.from(document.querySelectorAll(s));
        const $ = (s) => document.querySelector(s);

        const search = $('#faq-search');
        const items = $$('.faq-item');
        const toggles = $$('.faq-toggle');
        const categoryBtns = $$('.faq-cat-btn');


        /***************
         LIVE SEARCH
        ****************/
        search?.addEventListener('input', () => {
            const q = search.value.toLowerCase().trim();

            let visible = 0;

            items.forEach((item) => {
                const text =
                    item.innerText.toLowerCase() +
                    (item.getAttribute('data-keywords') || '').toLowerCase();

                const match = text.includes(q);
                item.style.display = match ? "block" : "none";
                if (match) visible++;
            });

            // Handle "no results" message
            let empty = $('#faq-empty');
            if (!visible) {
                if (!empty) {
                    empty = document.createElement('div');
                    empty.id = "faq-empty";
                    empty.className = "faq-empty";
                    empty.textContent = "No results found.";
                    $('.faq-content').appendChild(empty);
                }
            } else if (empty) {
                empty.remove();
            }
        });

        /***************
         Expand/Collapse FAQ Items
        ****************/
        document.querySelectorAll(".faq-item").forEach((item) => {
    const btn = item.querySelector(".faq-toggle");
    const panel = item.querySelector(".faq-panel");
    const chev = item.querySelector(".faq-chev svg");

    btn.addEventListener("click", () => {
        const isOpen = item.getAttribute("aria-expanded") === "true";

        item.setAttribute("aria-expanded", !isOpen);

        if (!isOpen) {
            panel.style.maxHeight = panel.scrollHeight + "px";
            panel.style.opacity = "1";
            chev.style.transform = "rotate(180deg)";
        } else {
            panel.style.maxHeight = "0px";
            panel.style.opacity = "0";
            chev.style.transform = "rotate(0deg)";
        }
    });
});


        /***************
         SIDEBAR SCROLL-SPY
        ****************/
        categoryBtns.forEach((btn) => {
            btn.addEventListener('click', () => {
                categoryBtns.forEach((b) => b.removeAttribute('aria-current'));
                btn.setAttribute('aria-current', 'true');

                const target = document.getElementById(btn.dataset.target);
                if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        const sections = $$('.faq-section');

        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        categoryBtns.forEach((btn) => {
                            btn.removeAttribute('aria-current');
                            if (btn.dataset.target === id) {
                                btn.setAttribute('aria-current', 'true');
                            }
                        });
                    }
                });
            },
            { rootMargin: '-40% 0px -50% 0px', threshold: 0 }
        );

        sections.forEach((sec) => observer.observe(sec));

        /***************
         LAST UPDATED LABEL
        ****************/
        const last = $('#faq-last-updated');
        if (last) {
            const now = new Date();
            const pad = (n) => String(n).padStart(2, '0');
            last.textContent =
                now.getFullYear() +
                '-' +
                pad(now.getMonth() + 1) +
                '-' +
                pad(now.getDate()) +
                ' ' +
                pad(now.getHours()) +
                ':' +
                pad(now.getMinutes());
        }
    })();


</script>

<script>

    const editButtons = document.querySelectorAll(".faq-edit-btn");
    const editModal = document.getElementById("faq-edit-modal");
    const editIdField = document.getElementById("edit-id");
    const editQuestionField = document.getElementById("edit-question");
    const editTypeField = document.getElementById("edit-type");
    const editAnswerField = document.getElementById("edit-answer");

    editButtons.forEach(btn => {
        btn.addEventListener("click", async () => {
            const id = btn.dataset.id;

            // 1. Fetch FAQ data from backend
            try {
                const res = await fetch("/admin/faq/get", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ id })
                });

                const data = await res.json();

                // 2. Fill modal fields
                editIdField.value = id;
                editQuestionField.value = data.question;
                editTypeField.value = data.type;
                editAnswerField.value = data.ans;

                // 3. Show modal
                editModal.style.display = "flex";

            } catch (error) {
                console.error("Error loading FAQ:", error);
                alert("Failed to load FAQ data.");
            }
        });
    });


    const saveEditBtn = document.getElementById("save-edit-btn");
    const closeEditBtn = document.getElementById("close-edit-btn");
    function closeEditModal() {
        editModal.style.display = "none";
    }
    closeEditBtn.addEventListener("click", closeEditModal);

    saveEditBtn.addEventListener("click", async () => {
        const id = editIdField.value;
        const question = editQuestionField.value.trim();
        const type = editTypeField.value;
        const ans = editAnswerField.value.trim();

        if (!question || !ans) {
            alert("Question and Answer cannot be empty!");
            return;
        }

        try {
            const res = await fetch("/admin/faq/edit", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    id,
                    question,
                    type,
                    ans
                })
            });

            const data = await res.json();

            if (data.success) {
                // Optional: Update DOM without reload
                const item = document.querySelector(`.faq-item[data-id='${id}']`);
                if (item) {
                    item.querySelector(".faq-q-text").textContent = question;
                    item.querySelector(".faq-panel p").textContent = ans;
                }

                // Close modal
                closeEditModal();

                // Optional: Reload page if you want full refresh
                // location.reload();

            } else {
                alert("Failed to update FAQ.");
            }
        } catch (error) {
            console.error("Error updating FAQ:", error);
            alert("Something went wrong.");
        }
    });


    const deleteButtons = document.querySelectorAll(".faq-del-btn");
    const deleteModal = document.getElementById("faq-delete-modal");
    const deleteText = document.getElementById("delete-text");
    const confirmDeleteBtn = document.getElementById("confirm-delete-btn");
    const cancelDeleteBtn = document.getElementById("cancel-delete-btn");

    let deleteId = null;
    deleteButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            deleteId = btn.dataset.id;

            deleteText.textContent = `Are you sure you want to delete FAQ #${deleteId}?`;

            deleteModal.style.display = "flex";
        });
    });

    cancelDeleteBtn.addEventListener("click", () => {
        deleteModal.style.display = "none";
        deleteId = null;
    });

    confirmDeleteBtn.addEventListener("click", async () => {
        if (!deleteId) return;

        try {
            const res = await fetch("/admin/faq/delete", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ id: deleteId })
            });

            const data = await res.json();

            if (data.success) {
                // Remove item from DOM
                const item = document.querySelector(`.faq-item[data-id='${deleteId}']`);
                if (item) {
                    item.classList.add("faq-fade-out");
                    setTimeout(() => item.remove(), 300);
                }

                deleteModal.style.display = "none";
                deleteId = null;

            } else {
                alert("Failed to delete FAQ.");
            }

        } catch (error) {
            console.error("Delete error:", error);
            alert("Something went wrong.");
        }
    });


</script>